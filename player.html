<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>도레미곰 노래 플레이어</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;600;700&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-1: #0f1b2b;
      --bg-2: #1c3147;
      --ink: #f6f4ef;
      --muted: #b9c1cf;
      --accent: #ffb86b;
      --accent-2: #67d3c2;
      --card: rgba(255, 255, 255, 0.08);
      --stroke: rgba(255, 255, 255, 0.14);
      --shadow: rgba(0, 0, 0, 0.35);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Noto Sans KR", "Space Grotesk", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(103, 211, 194, 0.25), transparent 60%),
        radial-gradient(900px 600px at 90% 0%, rgba(255, 184, 107, 0.25), transparent 60%),
        linear-gradient(140deg, var(--bg-1), var(--bg-2));
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .app {
      width: min(1100px, 100%);
      display: grid;
      gap: 22px;
      animation: floatIn 0.7s ease-out;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 14px 20px;
      border: 1px solid var(--stroke);
      border-radius: 16px;
      background: var(--card);
      backdrop-filter: blur(10px);
      box-shadow: 0 12px 30px var(--shadow);
    }

    header h1 {
      margin: 0;
      font-family: "Space Grotesk", "Noto Sans KR", sans-serif;
      font-size: clamp(20px, 3vw, 28px);
      letter-spacing: -0.02em;
    }

    header .status {
      font-size: 14px;
      color: var(--muted);
    }

    .grid {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 22px;
    }

    .left-column {
      display: grid;
      gap: 22px;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: 18px;
      padding: 22px;
      box-shadow: 0 14px 34px var(--shadow);
      backdrop-filter: blur(10px);
    }

    .now {
      display: grid;
      gap: 6px;
    }

    .now .label {
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.18em;
      font-size: 11px;
    }

    .now .title {
      font-size: clamp(22px, 3vw, 30px);
      font-weight: 700;
    }

    .now .code {
      font-size: 13px;
      color: var(--muted);
    }

    .controls {
      display: grid;
      gap: 18px;
      margin-top: 22px;
    }

    .buttons {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      border: 1px solid transparent;
      background: rgba(255, 255, 255, 0.12);
      color: var(--ink);
      padding: 10px 16px;
      border-radius: 999px;
      font-size: 14px;
      cursor: pointer;
      transition: transform 0.2s ease, border-color 0.2s ease, background 0.2s ease;
    }

    button:hover {
      transform: translateY(-1px);
      border-color: rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.18);
    }

    button.primary {
      background: linear-gradient(135deg, var(--accent), #ffc477);
      color: #2c1c0b;
      font-weight: 700;
    }

    button.toggle.active {
      border-color: var(--accent-2);
      background: rgba(103, 211, 194, 0.2);
      color: var(--accent-2);
    }

    .progress {
      display: grid;
      gap: 10px;
    }

    .time {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--muted);
    }

    input[type="range"] {
      width: 100%;
      accent-color: var(--accent);
    }

    .playlist {
      display: grid;
      gap: 12px;
      max-height: 520px;
      overflow: auto;
    }

    .playlist-header {
      display: grid;
      gap: 6px;
    }

    .title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .search {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 220px;
    }

    .search input {
      width: 100%;
      padding: 10px 14px;
      height: 40px;
      border-radius: 999px;
      border: 1px solid transparent;
      background: rgba(255, 255, 255, 0.12);
      color: var(--ink);
      font-size: 14px;
      transition: border-color 0.2s ease, background 0.2s ease;
    }

    .search input:focus {
      outline: none;
      border-color: rgba(255, 255, 255, 0.35);
      background: rgba(255, 255, 255, 0.18);
    }

    .search input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }

    .track {
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid transparent;
      background: rgba(255, 255, 255, 0.05);
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: border-color 0.2s ease, background 0.2s ease, transform 0.2s ease;
      animation: rise 0.4s ease both;
    }

    .track:hover {
      transform: translateY(-2px);
      border-color: rgba(255, 255, 255, 0.3);
    }

    .track.active {
      border-color: var(--accent);
      background: rgba(255, 184, 107, 0.15);
    }

    .track .line {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      width: 100%;
    }

    .track .name {
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .track a {
      color: var(--accent-2);
      text-decoration: none;
      white-space: nowrap;
    }

    .track a:hover { text-decoration: underline; }

    .mode {
      font-size: 12px;
      color: var(--muted);
    }

    .playlist-empty {
      padding: 14px;
      border-radius: 12px;
      border: 1px dashed rgba(255, 255, 255, 0.2);
      color: var(--muted);
      font-size: 13px;
      text-align: center;
    }

    .recommendations-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      margin-top: 16px;
    }

    .recommendation {
      padding: 14px;
      border-radius: 14px;
      border: 1px solid transparent;
      background: rgba(255, 255, 255, 0.07);
      display: grid;
      gap: 8px;
      cursor: pointer;
      transition: transform 0.2s ease, border-color 0.2s ease, background 0.2s ease;
      animation: rise 0.45s ease both;
    }

    .recommendation:hover {
      transform: translateY(-2px);
      border-color: rgba(255, 255, 255, 0.35);
      background: rgba(255, 255, 255, 0.12);
    }

    .recommendation .rec-title {
      font-weight: 700;
      font-size: 15px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .recommendation .rec-meta {
      font-size: 12px;
      color: var(--muted);
    }

    @keyframes floatIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes rise {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: 1fr;
      }
      .playlist {
        max-height: unset;
      }
      .recommendations {
        display: none;
      }
      .playlist-header {
        align-items: flex-start;
      }
      .title-row {
        flex-direction: column;
        align-items: flex-start;
      }
      .search {
        width: 100%;
        min-width: unset;
      }
      .buttons {
        gap: 6px;
      }
      .buttons button {
        padding: 8px 10px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <main class="app">
    <header>
      <h1>도레미곰 노래 플레이어</h1>
      <div class="status" id="modeStatus">연속재생</div>
    </header>

    <section class="grid">
      <div class="left-column">
        <div class="card">
          <div class="now">
            <div class="label">Now Playing</div>
            <div class="title" id="nowTitle">-</div>
            <div class="code" id="nowCode">-</div>
          </div>

          <div class="controls">
            <div class="buttons">
              <button id="prevBtn">이전</button>
              <button id="playBtn" class="primary">재생</button>
              <button id="nextBtn">다음</button>
              <button id="shuffleBtn" class="toggle">랜덤</button>
              <button id="repeatBtn" class="toggle">반복: 끔</button>
            </div>

            <div class="progress">
              <input type="range" id="progress" value="0" min="0" max="100" />
              <div class="time">
                <span id="currentTime">0:00</span>
                <span id="duration">0:00</span>
              </div>
            </div>
          </div>
        </div>

        <div class="card recommendations">
          <div class="now">
            <div class="label">추천</div>
            <div class="title">랜덤 추천 4곡</div>
          </div>
          <div class="recommendations-grid" id="recommendations"></div>
        </div>
      </div>

      <div class="card">
        <div class="playlist-header">
          <div class="now">
            <div class="label">Playlist</div>
            <div class="title-row">
              <div class="title" id="playlistTitle">노래 목록</div>
              <div class="search">
                <label class="sr-only" for="searchInput">노래 검색</label>
                <input id="searchInput" type="text" placeholder="노래 검색" />
              </div>
            </div>
          </div>
        </div>
        <div class="playlist" id="playlist"></div>
      </div>
    </section>
  </main>

  <audio id="audio"></audio>

  <script>
    const tracks = [
  {
    order: 1,
    title: "톡톡톡, 괜찮아?",
    pageTitle: "노래하는 도레미곰 - [톡톡톡, 괜찮아?]",
    code: "13301B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13301B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/01B.mp3"
  },
  {
    order: 2,
    title: "동물 도미노",
    pageTitle: "노래하는 도레미곰 - [동물 도미노]",
    code: "13302B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13302B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/02B.mp3"
  },
  {
    order: 3,
    title: "앙앙의 턱받이",
    pageTitle: "노래하는 도레미곰 - [앙앙의 턱받이]",
    code: "13303B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13303B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/03B.mp3"
  },
  {
    order: 4,
    title: "도시락을 열면",
    pageTitle: "노래하는 도레미곰 - [도시락을 열면]",
    code: "13304B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13304B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/04B.mp3"
  },
  {
    order: 5,
    title: "편지가 왔어요",
    pageTitle: "노래하는 도레미곰 - [편지가 왔어요]",
    code: "13305B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13305B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/05B.mp3"
  },
  {
    order: 6,
    title: "하나씩 하나씩",
    pageTitle: "노래하는 도레미곰 - [하나씩 하나씩]",
    code: "13306B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13306B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/06B.mp3"
  },
  {
    order: 7,
    title: "나는 건 무서워요",
    pageTitle: "노래하는 도레미곰 - [나는 건 무서워요]",
    code: "13307B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13307B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/07B.mp3"
  },
  {
    order: 8,
    title: "팬티를 입을 수 있니?",
    pageTitle: "노래하는 도레미곰 - [팬티를 입을 수 있니?]",
    code: "13308B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13308B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/08B.mp3"
  },
  {
    order: 9,
    title: "우산 사세요",
    pageTitle: "노래하는 도레미곰 - [우산 사세요]",
    code: "13346B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13346B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/46B.mp3"
  },
  {
    order: 10,
    title: "도토리가 없잖아",
    pageTitle: "노래하는 도레미곰 - [도토리가 없잖아]",
    code: "13309B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13309B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/09B.mp3"
  },
  {
    order: 11,
    title: "곰아, 괜찮아?",
    pageTitle: "노래하는 도레미곰 - [곰아, 괜찮아?]",
    code: "13310B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13310B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/10B.mp3"
  },
  {
    order: 12,
    title: "내가 제일 커!",
    pageTitle: "노래하는 도레미곰 - [내가 제일 커!]",
    code: "13311B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13311B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/11B.mp3"
  },
  {
    order: 13,
    title: "어린 왕의 작은 상자",
    pageTitle: "노래하는 도레미곰 - [어린 왕의 작은 상자]",
    code: "13312B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13312B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/12B.mp3"
  },
  {
    order: 14,
    title: "생쥐와 딸기와 배고픈 곰",
    pageTitle: "노래하는 도레미곰 - [생쥐와 딸기와 배고픈 곰]",
    code: "13313B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13313B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/13B.mp3"
  },
  {
    order: 15,
    title: "꼭꼭 숨어라!",
    pageTitle: "노래하는 도레미곰 - [꼭꼭 숨어라!]",
    code: "13347B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13347B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/47B.mp3"
  },
  {
    order: 16,
    title: "꿈나라 기차",
    pageTitle: "노래하는 도레미곰 - [꿈나라 기차]",
    code: "13314B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13314B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/14B.mp3"
  },
  {
    order: 18,
    title: "유치원에 간 악어",
    pageTitle: "노래하는 도레미곰 - [유치원에 간 악어]",
    code: "13316B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13316B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/16B.mp3"
  },
  {
    order: 19,
    title: "내 거야, 내 거!",
    pageTitle: "노래하는 도레미곰 - [내 거야, 내 거!]",
    code: "13317B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13317B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/17B.mp3"
  },
  {
    order: 20,
    title: "기찻길은 계속돼",
    pageTitle: "노래하는 도레미곰 - [기찻길은 계속돼]",
    code: "13318B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13318B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/18B.mp3"
  },
  {
    order: 21,
    title: "물고기 마을의 경찰 아저씨",
    pageTitle: "노래하는 도레미곰 - [물고기 마을의 경찰 아저씨]",
    code: "13319B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13319B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/19B.mp3"
  },
  {
    order: 22,
    title: "자전거를 탄 곰",
    pageTitle: "노래하는 도레미곰 - [자전거를 탄 곰]",
    code: "13320B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13320B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/20B.mp3"
  },
  {
    order: 23,
    title: "그리즐리는 가려워",
    pageTitle: "노래하는 도레미곰 - [그리즐리는 가려워]",
    code: "13348B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13348B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/48B.mp3"
  },
  {
    order: 24,
    title: "그렇게 하는 게 아니야!",
    pageTitle: "노래하는 도레미곰 - [그렇게 하는 게 아니야!]",
    code: "13321B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13321B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/21B.mp3"
  },
  {
    order: 25,
    title: "책 속에 괴물이 있어",
    pageTitle: "노래하는 도레미곰 - [책 속에 괴물이 있어]",
    code: "13322B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13322B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/22B.mp3"
  },
  {
    order: 26,
    title: "에드워드의 음악회",
    pageTitle: "노래하는 도레미곰 - [에드워드의 음악회]",
    code: "13349B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13349B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/49B.mp3"
  },
  {
    order: 27,
    title: "딜런의 병원 놀이",
    pageTitle: "노래하는 도레미곰 - [딜런의 병원 놀이]",
    code: "13323B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13323B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/23B.mp3"
  },
  {
    order: 28,
    title: "내 친구 거미",
    pageTitle: "노래하는 도레미곰 - [내 친구 거미]",
    code: "13350B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13350B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/50B.mp3"
  },
  {
    order: 29,
    title: "뭉게뭉게 주전자",
    pageTitle: "노래하는 도레미곰 - [뭉게뭉게 주전자]",
    code: "13324B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13324B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/24B.mp3"
  },
  {
    order: 30,
    title: "내 마음을 줄게",
    pageTitle: "노래하는 도레미곰 - [내 마음을 줄게]",
    code: "13326B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13326B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/26B.mp3"
  },
  {
    order: 32,
    title: "누가 제일 클까?",
    pageTitle: "노래하는 도레미곰 - [누가 제일 클까?]",
    code: "13328B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13328B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/28B.mp3"
  },
  {
    order: 33,
    title: "공주님이 될 거야",
    pageTitle: "노래하는 도레미곰 - [공주님이 될 거야]",
    code: "13329B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13329B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/29B.mp3"
  },
  {
    order: 34,
    title: "착한 아이는 이제 잘 시간",
    pageTitle: "노래하는 도레미곰 - [착한 아이는 이제 잘 시간]",
    code: "13330B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13330B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/30B.mp3"
  },
  {
    order: 35,
    title: "나도 안아 줘",
    pageTitle: "노래하는 도레미곰 - [나도 안아 줘]",
    code: "13331B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13331B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/31B.mp3"
  },
  {
    order: 36,
    title: "인형이 아니야",
    pageTitle: "노래하는 도레미곰 - [인형이 아니야]",
    code: "13332B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13332B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/32B.mp3"
  },
  {
    order: 37,
    title: "등불이 있으면 무섭지 않아",
    pageTitle: "노래하는 도레미곰 - [등불이 있으면 무섭지 않아]",
    code: "13351B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13351B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/51B.mp3"
  },
  {
    order: 38,
    title: "맛있는 코코아 한 잔",
    pageTitle: "노래하는 도레미곰 - [맛있는 코코아 한 잔]",
    code: "13333B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13333B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/33B.mp3"
  },
  {
    order: 39,
    title: "택시, 택시!",
    pageTitle: "노래하는 도레미곰 - [택시, 택시!]",
    code: "13334B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13334B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/34B.mp3"
  },
  {
    order: 40,
    title: "화나면 늑대",
    pageTitle: "노래하는 도레미곰 - [화나면 늑대]",
    code: "13335B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13335B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/35B.mp3"
  },
  {
    order: 41,
    title: "메이블의 콧수염",
    pageTitle: "노래하는 도레미곰 - [메이블의 콧수염]",
    code: "13352B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13352B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/52B.mp3"
  },
  {
    order: 42,
    title: "동생 공룡 돌보기",
    pageTitle: "노래하는 도레미곰 - [동생 공룡 돌보기]",
    code: "13338B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13338B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/38B.mp3"
  },
  {
    order: 43,
    title: "비 오는 날의 피망카",
    pageTitle: "노래하는 도레미곰 - [비 오는 날의 피망카]",
    code: "13339B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13339B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/39B.mp3"
  },
  {
    order: 44,
    title: "심술꾸러기 늑대",
    pageTitle: "노래하는 도레미곰 - [심술꾸러기 늑대]",
    code: "13340B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13340B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/40B.mp3"
  },
  {
    order: 45,
    title: "꼬마 크리스마스트리",
    pageTitle: "노래하는 도레미곰 - [꼬마 크리스마스트리]",
    code: "13341B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13341B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/41B.mp3"
  },
  {
    order: 46,
    title: "코베의 공룡 인형",
    pageTitle: "노래하는 도레미곰 - [코베의 공룡 인형]",
    code: "13342B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13342B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/42B.mp3"
  },
  {
    order: 47,
    title: "바람에 날려 간 버트",
    pageTitle: "노래하는 도레미곰 - [바람에 날려 간 버트]",
    code: "13343B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13343B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/43B.mp3"
  },
  {
    order: 48,
    title: "토끼를 잡아라!",
    pageTitle: "노래하는 도레미곰 - [토끼를 잡아라!]",
    code: "13344B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13344B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/44B.mp3"
  },
  {
    order: 50,
    title: "눈 아래 사는 친구들",
    pageTitle: "노래하는 도레미곰 - [눈 아래 사는 친구들]",
    code: "13345B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13345B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/45B.mp3"
  },
  {
    order: 51,
    title: "케첩 기차",
    pageTitle: "노래하는 도레미곰 - [케첩 기차]",
    code: "13325B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13325B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/25B.mp3"
  },
  {
    order: 52,
    title: "빗물 울보",
    pageTitle: "노래하는 도레미곰 - [빗물 울보]",
    code: "13337B",
    qr: "https://www.greatbooks.co.kr/qr_code/wb2/?cd=13337B",
    audio: "https://www.greatbooks.co.kr/upload/cdn/qr_code/wb2/sound/37B.mp3"
  },
];

    tracks.sort((a, b) => a.order - b.order);

    const audio = document.getElementById("audio");
    const nowTitle = document.getElementById("nowTitle");
    const nowCode = document.getElementById("nowCode");
    const playBtn = document.getElementById("playBtn");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const shuffleBtn = document.getElementById("shuffleBtn");
    const repeatBtn = document.getElementById("repeatBtn");
    const progress = document.getElementById("progress");
    const currentTimeEl = document.getElementById("currentTime");
    const durationEl = document.getElementById("duration");
    const playlistEl = document.getElementById("playlist");
    const searchInput = document.getElementById("searchInput");
    const recommendationsEl = document.getElementById("recommendations");
    const modeStatus = document.getElementById("modeStatus");

    let currentIndex = 0;
    let shuffleOn = false;
    let repeatMode = 0;
    const history = [];

    function formatTime(seconds) {
      if (!Number.isFinite(seconds)) return "0:00";
      const m = Math.floor(seconds / 60);
      const s = Math.floor(seconds % 60).toString().padStart(2, "0");
      return `${m}:${s}`;
    }

    function updateModeStatus() {
      let label = "연속재생";
      if (shuffleOn) label = "랜덤재생";
      if (repeatMode === 1) label = "한 곡 반복";
      if (repeatMode === 2) label = "전체 반복";
      if (shuffleOn && repeatMode === 1) label = "랜덤 + 한 곡 반복";
      if (shuffleOn && repeatMode === 2) label = "랜덤 + 전체 반복";
      modeStatus.textContent = label;
    }

    function setActiveTrack(index) {
      const items = playlistEl.querySelectorAll(".track");
      items.forEach((item) => {
        const itemIndex = Number(item.dataset.index);
        item.classList.toggle("active", itemIndex === index);
      });
    }

    function loadTrack(index, autoPlay = true) {
      currentIndex = index;
      const track = tracks[index];
      audio.src = track.audio;
      nowTitle.textContent = track.title;
      nowCode.textContent = `순번 ${String(track.order).padStart(2, "0")} · 코드 ${track.code}`;
      setActiveTrack(index);
      if (autoPlay) {
        audio.play();
        playBtn.textContent = "일시정지";
      }
    }

    function playPause() {
      if (audio.paused) {
        audio.play();
        playBtn.textContent = "일시정지";
      } else {
        audio.pause();
        playBtn.textContent = "재생";
      }
    }

    function nextTrack() {
      if (shuffleOn) {
        history.push(currentIndex);
        let next = currentIndex;
        if (tracks.length > 1) {
          while (next === currentIndex) {
            next = Math.floor(Math.random() * tracks.length);
          }
        }
        loadTrack(next);
        return;
      }
      if (currentIndex < tracks.length - 1) {
        loadTrack(currentIndex + 1);
      } else if (repeatMode === 2) {
        loadTrack(0);
      } else {
        audio.pause();
        playBtn.textContent = "재생";
      }
    }

    function prevTrack() {
      if (shuffleOn && history.length) {
        const prev = history.pop();
        loadTrack(prev);
        return;
      }
      if (currentIndex > 0) {
        loadTrack(currentIndex - 1);
      } else if (repeatMode === 2) {
        loadTrack(tracks.length - 1);
      } else {
        audio.currentTime = 0;
      }
    }

    function handleEnded() {
      if (repeatMode === 1) {
        audio.currentTime = 0;
        audio.play();
        return;
      }
      nextTrack();
    }

    const CHO = [
      "ㄱ", "ㄲ", "ㄴ", "ㄷ", "ㄸ", "ㄹ", "ㅁ", "ㅂ", "ㅃ", "ㅅ",
      "ㅆ", "ㅇ", "ㅈ", "ㅉ", "ㅊ", "ㅋ", "ㅌ", "ㅍ", "ㅎ"
    ];

    function normalize(value) {
      return value.toLowerCase().replace(/\s+/g, "");
    }

    function getChosung(value) {
      let result = "";
      for (const ch of value) {
        const code = ch.charCodeAt(0);
        if (code >= 0xac00 && code <= 0xd7a3) {
          const index = Math.floor((code - 0xac00) / 588);
          result += CHO[index] || "";
          continue;
        }
        if (ch >= "ㄱ" && ch <= "ㅎ") {
          result += ch;
        }
      }
      return result;
    }

    function getFilteredIndices(query) {
      if (!query) return tracks.map((_, index) => index);
      const q = normalize(query);
      const isInitialOnly = /^[ㄱ-ㅎ]+$/.test(q);
      return tracks
        .map((track, index) => ({ track, index }))
        .filter(({ track }) => {
          const haystack = normalize(`${track.title} ${track.order} ${track.code}`);
          if (haystack.includes(q)) return true;
          if (isInitialOnly) {
            const initials = getChosung(track.title);
            return initials.includes(q);
          }
          return false;
        })
        .map(({ index }) => index);
    }

    function renderPlaylist(filteredIndices = tracks.map((_, index) => index)) {
      playlistEl.innerHTML = "";
      if (filteredIndices.length === 0) {
        const empty = document.createElement("div");
        empty.className = "playlist-empty";
        empty.textContent = "검색 결과가 없습니다.";
        playlistEl.appendChild(empty);
        return;
      }
      filteredIndices.forEach((trackIndex, listIndex) => {
        const track = tracks[trackIndex];
        const item = document.createElement("div");
        item.className = "track";
        item.dataset.index = trackIndex;
        item.style.animationDelay = `${listIndex * 0.04}s`;
        item.innerHTML = `
          <div class="line">
            <span class="name">${String(track.order).padStart(2, "0")}. ${track.title}</span>
            <a href="${track.qr}" target="_blank" rel="noopener">QR 페이지</a>
          </div>
        `;
        item.addEventListener("click", () => loadTrack(trackIndex));
        playlistEl.appendChild(item);
      });
      setActiveTrack(currentIndex);
    }

    function pickRandomIndices(count) {
      const pool = tracks.map((_, index) => index);
      for (let i = pool.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * (i + 1));
        [pool[i], pool[j]] = [pool[j], pool[i]];
      }
      return pool.slice(0, Math.min(count, pool.length));
    }

    function renderRecommendations() {
      if (!recommendationsEl) return;
      recommendationsEl.innerHTML = "";
      const picks = pickRandomIndices(4);
      picks.forEach((trackIndex, idx) => {
        const track = tracks[trackIndex];
        const item = document.createElement("div");
        item.className = "recommendation";
        item.dataset.index = trackIndex;
        item.style.animationDelay = `${idx * 0.05}s`;
        item.innerHTML = `
          <div class="rec-title">${String(track.order).padStart(2, "0")}. ${track.title}</div>
          <div class="rec-meta">코드 ${track.code}</div>
        `;
        item.addEventListener("click", () => loadTrack(trackIndex));
        recommendationsEl.appendChild(item);
      });
    }

    playBtn.addEventListener("click", playPause);
    nextBtn.addEventListener("click", nextTrack);
    prevBtn.addEventListener("click", prevTrack);

    shuffleBtn.addEventListener("click", () => {
      shuffleOn = !shuffleOn;
      shuffleBtn.classList.toggle("active", shuffleOn);
      updateModeStatus();
    });

    repeatBtn.addEventListener("click", () => {
      repeatMode = (repeatMode + 1) % 3;
      repeatBtn.classList.toggle("active", repeatMode !== 0);
      if (repeatMode === 0) repeatBtn.textContent = "반복: 끔";
      if (repeatMode === 1) repeatBtn.textContent = "반복: 한 곡";
      if (repeatMode === 2) repeatBtn.textContent = "반복: 전체";
      updateModeStatus();
    });

    audio.addEventListener("timeupdate", () => {
      progress.value = audio.duration ? (audio.currentTime / audio.duration) * 100 : 0;
      currentTimeEl.textContent = formatTime(audio.currentTime);
      durationEl.textContent = formatTime(audio.duration);
    });

    progress.addEventListener("input", () => {
      if (audio.duration) {
        audio.currentTime = (progress.value / 100) * audio.duration;
      }
    });

    audio.addEventListener("ended", handleEnded);

    renderPlaylist();
    renderRecommendations();
    loadTrack(0, false);
    updateModeStatus();

    searchInput.addEventListener("input", (event) => {
      const filtered = getFilteredIndices(event.target.value);
      renderPlaylist(filtered);
    });
  </script>
</body>
</html>
